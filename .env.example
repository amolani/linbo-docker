# =============================================================================
# LINBO Docker - Environment Configuration
# Copy this file to .env and adjust values
# =============================================================================

# =============================================================================
# Server Configuration
# =============================================================================

# IP address of the Docker host (visible to PXE clients)
LINBO_SERVER_IP=10.0.0.1

# Environment (development, production)
NODE_ENV=development

# =============================================================================
# API Configuration
# =============================================================================

# API server port
API_PORT=3000

# API server host (0.0.0.0 for all interfaces)
API_HOST=0.0.0.0

# CORS origin (use specific domain in production)
CORS_ORIGIN=*

# =============================================================================
# Database Configuration (PostgreSQL)
# =============================================================================

# PostgreSQL password (CHANGE IN PRODUCTION!)
POSTGRES_PASSWORD=linbo_secret_password

# PostgreSQL user
POSTGRES_USER=linbo

# PostgreSQL database name
POSTGRES_DB=linbo

# PostgreSQL host (container name in docker-compose)
POSTGRES_HOST=linbo-db

# PostgreSQL port
POSTGRES_PORT=5432

# Full database URL for Prisma (automatically constructed if not set)
# DATABASE_URL=postgresql://linbo:linbo_secret_password@linbo-db:5432/linbo?schema=public
DATABASE_URL=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}:${POSTGRES_PORT}/${POSTGRES_DB}?schema=public

# =============================================================================
# Redis Configuration
# =============================================================================

# Redis host (container name in docker-compose)
REDIS_HOST=linbo-cache

# Redis port
REDIS_PORT=6379

# Redis password (optional, leave empty if none)
REDIS_PASSWORD=

# Redis database number (0-15)
REDIS_DB=0

# =============================================================================
# Authentication (JWT)
# =============================================================================

# JWT Secret for API authentication (CHANGE IN PRODUCTION!)
# Generate with: openssl rand -base64 64
JWT_SECRET=your_jwt_secret_here_change_me_in_production_use_openssl_rand

# JWT token expiration (e.g., 24h, 7d, 30d)
JWT_EXPIRES_IN=24h

# API Key prefix for generated keys
API_KEY_PREFIX=lnb_

# =============================================================================
# SSH Configuration (for remote commands)
# =============================================================================

# SSH container host
SSH_HOST=linbo-ssh

# SSH container internal port
SSH_PORT=22

# SSH connection timeout in milliseconds
SSH_TIMEOUT=10000

# SSH username for client connections
SSH_USER=root

# Path to SSH private key (inside container)
SSH_PRIVATE_KEY=/etc/linuxmuster/linbo/ssh_host_rsa_key

# =============================================================================
# RSYNC Configuration
# =============================================================================

# RSYNC password for image uploads (CHANGE IN PRODUCTION!)
# Also update in config/rsyncd.secrets
RSYNC_PASSWORD=linbo_rsync_secret

# =============================================================================
# Storage Paths
# =============================================================================

# LINBO data directory (images, boot files)
LINBO_DATA_DIR=/srv/linbo

# LINBO image directory
LINBO_IMAGE_DIR=/srv/linbo/images

# LINBO config directory
LINBO_CONFIG_DIR=/etc/linuxmuster/linbo

# LINBO log directory
LINBO_LOG_DIR=/var/log/linuxmuster/linbo

# =============================================================================
# Logging
# =============================================================================

# Log level (debug, info, warn, error)
LOG_LEVEL=info

# Enable request logging (true/false)
REQUEST_LOGGING=true

# =============================================================================
# Rate Limiting
# =============================================================================

# Max requests per minute per IP
RATE_LIMIT_MAX=100

# Rate limit window in minutes
RATE_LIMIT_WINDOW=1

# =============================================================================
# Web UI Configuration
# =============================================================================

# Web UI port (default: 8080)
WEB_PORT=8080

# =============================================================================
# Optional: External Services
# =============================================================================

# If using external PostgreSQL (overrides individual settings)
# DATABASE_URL=postgresql://user:password@external-host:5432/linbo

# If using external Redis (overrides individual settings)
# REDIS_URL=redis://:password@external-host:6379/0

# =============================================================================
# Operation Worker Configuration
# =============================================================================

# Enable/disable the background operation worker
ENABLE_OPERATION_WORKER=true

# Poll interval for pending operations in milliseconds
OPERATION_POLL_INTERVAL=5000

# Maximum concurrent SSH sessions per operation batch
MAX_CONCURRENT_SESSIONS=5

# =============================================================================
# Internal API Configuration
# =============================================================================

# Internal API key for service-to-service communication (RSYNC hooks, etc.)
# Generate with: openssl rand -hex 32
INTERNAL_API_KEY=linbo-internal-secret-change-in-production

# =============================================================================
# Update-Linbofs Configuration
# =============================================================================

# Path to update-linbofs script
UPDATE_LINBOFS_SCRIPT=/usr/share/linuxmuster/linbo/update-linbofs.sh

# LINBO directory (where linbofs64 is stored)
LINBO_DIR=/srv/linbo

# LINBO config directory (SSH keys, dropbear keys)
CONFIG_DIR=/etc/linuxmuster/linbo

# =============================================================================
# Optional: Feature Flags
# =============================================================================

# Enable BitTorrent distribution (requires linbo-torrent container)
ENABLE_TORRENT=false

# Enable Multicast distribution (requires linbo-multicast container)
ENABLE_MULTICAST=false

# Enable audit logging to database
ENABLE_AUDIT_LOG=true

# =============================================================================
# Host Status Worker (Stale Timeout + Port Scanner)
# =============================================================================

# Seconds before online hosts are marked offline (0 = disabled)
HOST_OFFLINE_TIMEOUT_SEC=300

# Enable TCP port scanning to detect OS (true/false)
HOST_SCAN_ENABLED=true

# Scan cycle interval in seconds
HOST_SCAN_INTERVAL_SEC=60

# Max parallel TCP connections during scan
HOST_SCAN_CONCURRENCY=30

# TCP connect timeout per port in milliseconds
HOST_SCAN_PORT_TIMEOUT_MS=500

# Failed scans before clearing detectedOs
HOST_SCAN_STALE_AFTER=5

# =============================================================================
# Development Settings
# =============================================================================

# Enable Prisma query logging in development
PRISMA_LOG_QUERIES=false

# Enable detailed error messages
DEBUG_ERRORS=true
