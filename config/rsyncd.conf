# =============================================================================
# LINBO Docker - RSYNC Configuration
# =============================================================================

# Global settings
pid file = /var/run/rsyncd.pid
log file = /var/log/rsyncd.log
transfer logging = true
log format = %h %o %f %l %b
max connections = 50
timeout = 600

# =============================================================================
# [linbo] - Read-only access for clients to download
# =============================================================================
[linbo]
comment = LINBO Image directory (read-only)
path = /srv/linbo
use chroot = no
lock file = /var/lock/rsyncd.linbo
read only = yes
list = yes
uid = nobody
gid = nogroup
dont compress = *.qcow2 *.qdiff *.cloop *.rsync *.gz *.lz *.xz *.zst

# API-integrated hooks for download tracking
pre-xfer exec = /usr/share/linuxmuster/linbo/rsync-pre-download-api.sh
post-xfer exec = /usr/share/linuxmuster/linbo/rsync-post-download-api.sh

# =============================================================================
# [linbo-upload] - Authenticated upload for image creation
# =============================================================================
[linbo-upload]
comment = LINBO Upload directory (authenticated)
path = /srv/linbo
use chroot = no
lock file = /var/lock/rsyncd.upload
read only = no
list = no
uid = root
gid = root
dont compress = *.qcow2 *.qdiff *.cloop *.rsync *.gz *.lz *.xz *.zst
auth users = linbo
secrets file = /etc/rsyncd.secrets

# API-integrated hooks for upload tracking and image registration
pre-xfer exec = /usr/share/linuxmuster/linbo/rsync-pre-upload-api.sh
post-xfer exec = /usr/share/linuxmuster/linbo/rsync-post-upload-api.sh

# =============================================================================
# [drivers] - Read-only access for patchclass driver sets (Phase 17)
# =============================================================================
[drivers]
comment = LINBO Driver repository (read-only, per-patchclass)
path = /var/lib/linbo/drivers
use chroot = no
lock file = /var/lock/rsyncd.drivers
read only = yes
list = yes
uid = nobody
gid = nogroup
dont compress = *.cab *.zip *.gz *.xz *.zst
